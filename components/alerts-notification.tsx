import React, { useState, useEffect } from 'react';\nimport { View, Text, ScrollView, TouchableOpacity, ActivityIndicator } from 'react-native';\nimport { useColors } from '@/hooks/use-colors';\nimport { useAuth } from '@/hooks/use-auth';\n\ninterface Alert {\n  id: number;\n  alertType: 'low_success_rate' | 'high_bounce_rate' | 'delivery_failure';\n  severity: 'info' | 'warning' | 'critical';\n  message: string;\n  currentValue: number;\n  threshold: number;\n  createdAt: string;\n  isResolved: boolean;\n}\n\ninterface AlertsNotificationProps {\n  visible: boolean;\n  onClose: () => void;\n}\n\nexport function AlertsNotification({ visible, onClose }: AlertsNotificationProps) {\n  const colors = useColors();\n  const { user } = useAuth();\n  const [alerts, setAlerts] = useState<Alert[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [stats, setStats] = useState<any>(null);\n\n  useEffect(() => {\n    if (visible && user) {\n      loadAlerts();\n    }\n  }, [visible, user]);\n\n  const loadAlerts = async () => {\n    setLoading(true);\n    try {\n      // Fetch active alerts\n      const response = await fetch(`/api/alerts/active?userId=${user?.id}`);\n      if (response.ok) {\n        const data = await response.json();\n        setAlerts(data.alerts || []);\n        setStats(data.stats);\n      }\n    } catch (error) {\n      console.error('Error loading alerts:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const resolveAlert = async (alertId: number) => {\n    try {\n      const response = await fetch(`/api/alerts/${alertId}/resolve`, {\n        method: 'POST',\n      });\n      if (response.ok) {\n        setAlerts(alerts.filter((a) => a.id !== alertId));\n      }\n    } catch (error) {\n      console.error('Error resolving alert:', error);\n    }\n  };\n\n  const getSeverityColor = (severity: string) => {\n    switch (severity) {\n      case 'critical':\n        return colors.error;\n      case 'warning':\n        return colors.warning;\n      default:\n        return colors.primary;\n    }\n  };\n\n  const getAlertIcon = (type: string) => {\n    switch (type) {\n      case 'low_success_rate':\n        return 'üìâ';\n      case 'high_bounce_rate':\n        return 'üìß';\n      case 'delivery_failure':\n        return '‚ùå';\n      default:\n        return '‚ÑπÔ∏è';\n    }\n  };\n\n  if (!visible) return null;\n\n  return (\n    <View\n      style={{\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        backgroundColor: 'rgba(0, 0, 0, 0.5)',\n        zIndex: 1000,\n        justifyContent: 'flex-end',\n      }}\n    >\n      <View\n        style={{\n          backgroundColor: colors.background,\n          borderTopLeftRadius: 20,\n          borderTopRightRadius: 20,\n          maxHeight: '80%',\n          paddingHorizontal: 20,\n          paddingTop: 20,\n          paddingBottom: 30,\n        }}\n      >\n        {/* Header */}\n        <View\n          style={{\n            flexDirection: 'row',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            marginBottom: 16,\n          }}\n        >\n          <View>\n            <Text style={{ fontSize: 20, fontWeight: '700', color: colors.foreground }}>\n              Performance Alerts\n            </Text>\n            {stats && (\n              <Text style={{ fontSize: 12, color: colors.muted, marginTop: 4 }}>\n                {stats.activeAlerts} active ‚Ä¢ {stats.criticalAlerts} critical\n              </Text>\n            )}\n          </View>\n          <TouchableOpacity onPress={onClose}>\n            <Text style={{ fontSize: 24, color: colors.muted }}>‚úï</Text>\n          </TouchableOpacity>\n        </View>\n\n        {/* Content */}\n        {loading ? (\n          <View style={{ justifyContent: 'center', alignItems: 'center', paddingVertical: 40 }}>\n            <ActivityIndicator size=\"large\" color={colors.primary} />\n          </View>\n        ) : alerts.length === 0 ? (\n          <View style={{ justifyContent: 'center', alignItems: 'center', paddingVertical: 40 }}>\n            <Text style={{ fontSize: 16, color: colors.muted, textAlign: 'center' }}>\n              ‚úì All systems operating normally\n            </Text>\n          </View>\n        ) : (\n          <ScrollView showsVerticalScrollIndicator={false}>\n            {alerts.map((alert) => (\n              <View\n                key={alert.id}\n                style={{\n                  backgroundColor: colors.surface,\n                  borderLeftWidth: 4,\n                  borderLeftColor: getSeverityColor(alert.severity),\n                  borderRadius: 8,\n                  padding: 12,\n                  marginBottom: 12,\n                }}\n              >\n                <View style={{ flexDirection: 'row', justifyContent: 'space-between', alignItems: 'flex-start' }}>\n                  <View style={{ flex: 1, marginRight: 8 }}>\n                    <View style={{ flexDirection: 'row', alignItems: 'center', marginBottom: 4 }}>\n                      <Text style={{ fontSize: 16, marginRight: 6 }}>{getAlertIcon(alert.alertType)}</Text>\n                      <Text\n                        style={{\n                          fontSize: 13,\n                          fontWeight: '600',\n                          color: colors.foreground,\n                          textTransform: 'capitalize',\n                        }}\n                      >\n                        {alert.alertType.replace(/_/g, ' ')}\n                      </Text>\n                      <Text\n                        style={{\n                          fontSize: 10,\n                          fontWeight: '600',\n                          color: colors.background,\n                          backgroundColor: getSeverityColor(alert.severity),\n                          paddingHorizontal: 6,\n                          paddingVertical: 2,\n                          borderRadius: 4,\n                          marginLeft: 6,\n                          textTransform: 'uppercase',\n                        }}\n                      >\n                        {alert.severity}\n                      </Text>\n                    </View>\n                    <Text style={{ fontSize: 12, color: colors.muted, lineHeight: 18 }}>\n                      {alert.message}\n                    </Text>\n                    <Text style={{ fontSize: 11, color: colors.muted, marginTop: 6 }}>\n                      Current: {alert.currentValue}% | Threshold: {alert.threshold}%\n                    </Text>\n                  </View>\n                  <TouchableOpacity\n                    onPress={() => resolveAlert(alert.id)}\n                    style={{\n                      paddingHorizontal: 8,\n                      paddingVertical: 4,\n                      backgroundColor: colors.primary,\n                      borderRadius: 4,\n                    }}\n                  >\n                    <Text style={{ fontSize: 11, fontWeight: '600', color: colors.background }}>Resolve</Text>\n                  </TouchableOpacity>\n                </View>\n              </View>\n            ))}\n          </ScrollView>\n        )}\n\n        {/* Footer */}\n        {alerts.length > 0 && (\n          <TouchableOpacity\n            onPress={onClose}\n            style={{\n              marginTop: 16,\n              paddingVertical: 12,\n              backgroundColor: colors.primary,\n              borderRadius: 8,\n              alignItems: 'center',\n            }}\n          >\n            <Text style={{ fontSize: 14, fontWeight: '600', color: colors.background }}>\n              Close\n            </Text>\n          </TouchableOpacity>\n        )}\n      </View>\n    </View>\n  );\n}\n
